version: 1
pruners:
    conv1_pruner:
        class: AutomatedGradualPruner
        initial_sparsity: 0.05
        final_sparsity: 0.15
        weights: [conv1.weight]

    conv2_pruner:
        class: AutomatedGradualPruner
        initial_sparsity: 0.05
        final_sparsity: 0.40
        weights: [conv2.weight]

    conv3_pruner:
        class: AutomatedGradualPruner
        initial_sparsity: 0.05
        final_sparsity: 0.70
        weights: [conv3a.weight,conv3b.weight]

    conv4_pruner:
        class: AutomatedGradualPruner
        initial_sparsity: 0.05
        final_sparsity: 0.90
        weights: [conv4a.weight,conv4b.weight]

    conv5_pruner:
        class: AutomatedGradualPruner
        initial_sparsity: 0.05
        final_sparsity: 0.90
        weights: [conv5a.weight,conv5b.weight]

    fc67_pruner:
        class: AutomatedGradualPruner
        initial_sparsity: 0.05
        final_sparsity: 0.90
        weights: [fc6.weight,fc7.weight]

    fc8_pruner:
        class: AutomatedGradualPruner
        initial_sparsity: 0.05
        final_sparsity: 0.70
        weights: [fc8.weight]

#######################################################
    filter_prune_low:
        class: L1RankedStructureParameterPruner
        group_type: Filters
        desired_sparsity: 0.1
        weights: [conv1.weight,conv2.weight]
    filter_prune_high:
        class: L1RankedStructureParameterPruner
        group_type: Filters
        desired_sparsity: 0.2
        weights: [conv3a.weight,conv3b.weight,conv4a.weight,conv4b.weight,
                  conv5a.weight,conv5b.weight,fc6.weight]
########################################################
quantizers:
    linear_quantizer:
        class: QuantAwareTrainRangeLinearQuantizer
        bits_activations: 8
        bits_weights: 8
        bits_bias: 8
        #bits_accum: 28
        #bits_sca
        mode: 'SYMMETRIC'
        ema_decay: 0.999
        per_channel_wts: True
        overrides:
            conv1:
                bits_weights: null
                bits_activations: null
                bits_bias: null
                #bits_accum: null
            relu1:
                bits_weights: null
                bits_activations: null
                bits_bias: null
                #bits_accum: null
            relu10:
                bits_weights: null
                bits_activations: null
                bits_bias: null
                #bits_accum: null
            fc8:
                bits_weights: null
                bits_activations: null
                bits_bias: null
                #bits_accum: null
                                             

policies:
    - pruner:
          instance_name: conv1_pruner
      starting_epoch: 1
      ending_epoch: 30
      frequency: 1
    - pruner:
          instance_name: conv2_pruner
      starting_epoch: 1
      ending_epoch: 30
      frequency: 1
    - pruner:
          instance_name: conv3_pruner
      starting_epoch: 1
      ending_epoch: 30
      frequency: 1
    - pruner:
          instance_name: conv4_pruner
      starting_epoch: 1
      ending_epoch: 30
      frequency: 1
    - pruner:
          instance_name: conv5_pruner
      starting_epoch: 1
      ending_epoch: 30
      frequency: 1
    - pruner:
          instance_name: fc67_pruner
      starting_epoch: 1
      ending_epoch: 30
      frequency: 1
    - pruner:
          instance_name: fc8_pruner
      starting_epoch: 1
      ending_epoch: 30
      frequency: 1

###################################################
    - pruner:
          instance_name: filter_prune_low
      epochs: [1,5,9,20]
    - pruner:
          instance_name: filter_prune_high
      epochs: [2,6,10,21]
    - quantizer:
          instance_name: linear_quantizer
      starting_epoch: 0
      ending_epoch: 300
      frequency: 1






